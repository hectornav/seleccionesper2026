{% extends 'candidatos/base.html' %}
{% load static %}

{% block title %}{{ candidato.nombre }} — Elecciones Perú 2026{% endblock %}

{% block content %}

<!-- HERO DEL CANDIDATO -->
<section style="background:linear-gradient(135deg,var(--dark),#16213e);padding:2.5rem 0 0;color:white">
    <div class="container">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-3">
            <ol class="breadcrumb breadcrumb-custom">
                <li class="breadcrumb-item"><a href="{% url 'candidatos:home' %}">Candidatos</a></li>
                <li class="breadcrumb-item active">{{ candidato.nombre }}</li>
            </ol>
        </nav>

        <div class="d-flex align-items-end hero-candidate-row" style="gap:1.25rem;flex-wrap:wrap">
            <!-- Foto -->
            <div class="flex-shrink-0">
                <div class="hero-candidate-photo"
                    style="width:140px;height:160px;border-radius:16px;overflow:hidden;border:3px solid rgba(255,255,255,0.2);background:#2d3748;flex-shrink:0">
                    {% if candidato.get_foto %}
                    <img src="{{ candidato.get_foto }}" alt="{{ candidato.nombre }}"
                        style="width:100%;height:100%;object-fit:cover;object-position:top">
                    {% else %}
                    <div
                        style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:60px;color:#4a5568">
                        <i class="bi bi-person-circle"></i>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Info básica -->
            <div class="flex-grow-1">
                <div class="d-flex flex-wrap gap-2 mb-2">
                    <span
                        style="background:{{ candidato.partido.color_primario }};color:white;border-radius:20px;padding:2px 12px;font-size:0.78rem;font-weight:700">
                        {{ candidato.partido.siglas }}
                    </span>
                    <span
                        style="background:{{ candidato.posicion_color }};color:white;border-radius:20px;padding:2px 12px;font-size:0.78rem;font-weight:600">
                        {% if candidato.posicion_label %}
                            {{ candidato.posicion_label }}
                        {% else %}
                            {{ candidato.posicion_politica|default:"(no informado)" }}
                        {% endif %}
                    </span>
                    {% if candidato.verificado %}
                    <span
                        style="background:rgba(39,174,96,0.2);color:#27ae60;border-radius:20px;padding:2px 10px;font-size:0.72rem;font-weight:600">
                        <i class="bi bi-check-circle-fill"></i> Verificado
                    </span>
                    {% endif %}
                </div>
                <h1 class="hero-candidate-name"
                    style="font-size:clamp(1.35rem,3vw,2.2rem);font-weight:800;margin-bottom:0.4rem">{{ candidato.nombre }}</h1>
                <div style="color:rgba(255,255,255,0.7);font-size:0.9rem;margin-bottom:0.75rem">
                    <i class="bi bi-briefcase"></i> {{ candidato.profesion }} &bull;
                    <i class="bi bi-geo-alt"></i> {{ candidato.region }} &bull;
                    <i class="bi bi-calendar3"></i> {{ candidato.edad }} años
                </div>
                {% if candidato.posicion_politica_detalle %}
                <div style="color:rgba(255,255,255,0.6);font-size:0.8rem;margin-bottom:0.5rem">
                    <i class="bi bi-compass"></i> {{ candidato.posicion_politica_detalle }}
                </div>
                {% endif %}
                {% if candidato.lema %}
                <p
                    style="font-style:italic;color:rgba(255,255,255,0.85);font-size:0.95rem;border-left:3px solid var(--gold);padding-left:0.75rem;max-width:500px;margin-bottom:0">
                    "{{ candidato.lema }}"
                </p>
                {% endif %}
            </div>
        </div>

        <!-- Tabs -->
        <div class="d-flex gap-1 mt-4 tab-bar-scroll" style="border-bottom:2px solid rgba(255,255,255,0.15)">
            <button class="tab-btn active" onclick="showTab('resumen')" id="tab-resumen">
                <i class="bi bi-star"></i> Resumen
            </button>
            <button class="tab-btn" onclick="showTab('propuestas')" id="tab-propuestas">
                <i class="bi bi-list-check"></i> Propuestas
            </button>
            <button class="tab-btn" onclick="showTab('posiciones')" id="tab-posiciones">
                <i class="bi bi-clipboard-check"></i> Posiciones
            </button>
            <button class="tab-btn" onclick="showTab('biografia')" id="tab-biografia">
                <i class="bi bi-person"></i> Biografía
            </button>
            {% if candidato.antecedentes %}
            <button class="tab-btn" onclick="showTab('antecedentes')" id="tab-antecedentes"
                style="color:rgba(255,180,80,0.8)">
                <i class="bi bi-exclamation-triangle"></i> Antecedentes
            </button>
            {% endif %}
        </div>
    </div>
</section>

<!-- CONTENIDO TABS -->
<div class="container py-4">
    <div class="row g-4">
        <div class="col-lg-8">

            <!-- TAB: RESUMEN (Nueva pestaña principal) -->
            <div id="content-resumen" class="tab-content-pane">
                <!-- Resumen General -->
                {% if candidato.resumen_propuestas %}
                <div class="card-white mb-4">
                    <h3 class="section-title mb-3">
                        <i class="bi bi-lightbulb text-warning"></i> Visión de Gobierno
                    </h3>
                    <p style="line-height:1.9;color:#4a5568;font-size:0.95rem">{{ candidato.resumen_propuestas }}</p>
                </div>
                {% endif %}

                <!-- Propuestas Destacadas -->
                {% if candidato.propuestas_destacadas %}
                <div class="card-white mb-4">
                    <h3 class="section-title mb-3">
                        <i class="bi bi-trophy text-warning"></i> Propuestas Destacadas
                    </h3>
                    <div class="propuestas-destacadas">
                        {% for propuesta in candidato.propuestas_destacadas %}
                        <div class="propuesta-destacada-item">
                            <div class="propuesta-num">{{ forloop.counter }}</div>
                            <div class="propuesta-texto">{{ propuesta }}</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Posicionamiento Rápido -->
                {% if candidato.posicionamiento_issues %}
                <div class="card-white mb-4">
                    <h3 class="section-title mb-3">
                        <i class="bi bi-diagram-3 text-primary"></i> Posición en Temas Clave
                    </h3>
                    <div class="issues-grid">
                        {% for issue, posicion in candidato.posicionamiento_issues.items %}
                        <div
                            class="issue-badge {% if posicion == 'a favor' %}a-favor{% elif posicion == 'en contra' %}en-contra{% elif posicion == 'neutral' %}neutral{% else %}parcial{% endif %}">
                            <span class="issue-label">{{ issue|cut:"_"|title }}</span>
                            <span class="issue-value">
                                {% if posicion == 'a favor' %}
                                <i class="bi bi-check-circle-fill"></i> A favor
                                {% elif posicion == 'en contra' %}
                                <i class="bi bi-x-circle-fill"></i> En contra
                                {% elif posicion == 'neutral' %}
                                <i class="bi bi-dash-circle-fill"></i> Neutral
                                {% else %}
                                <i class="bi bi-circle-half"></i> {{ posicion|title }}
                                {% endif %}
                            </span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Link al Plan de Gobierno -->
                {% if candidato.link_plan_gobierno %}
                <div class="card-white"
                    style="background:linear-gradient(135deg,#f8f9fa,#fff);border:2px solid var(--gold)">
                    <div class="d-flex align-items-center gap-3">
                        <div
                            style="width:50px;height:50px;background:var(--gold);border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0">
                            <i class="bi bi-bank" style="font-size:1.5rem;color:var(--dark)"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h5 style="margin:0;font-weight:700;font-size:0.95rem;color:var(--dark)">Plan de Gobierno
                                (JNE)</h5>
                            <p style="margin:0;font-size:0.82rem;color:#6c757d">Consulta oficial en la Plataforma
                                Electoral</p>
                        </div>
                        <a href="{{ candidato.link_plan_gobierno }}" target="_blank" rel="noopener" class="btn-peru"
                            style="white-space:nowrap">
                            <i class="bi bi-box-arrow-up-right"></i> Ver en JNE
                        </a>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- TAB: PROPUESTAS -->
            <div id="content-propuestas" class="tab-content-pane d-none">
                {% if propuestas_por_tema %}
                {% for tema, propuestas in propuestas_por_tema.items %}
                <div class="card-white mb-3">
                    <h4 class="tema-header">
                        <span class="tema-badge">
                            <i class="{{ propuestas.0.icono }}"></i> {{ tema }}
                        </span>
                        {% if propuestas.0.prioridad == 'alta' %}
                        <span class="prioridad-badge alta">Prioridad Alta</span>
                        {% elif propuestas.0.prioridad == 'media' %}
                        <span class="prioridad-badge media">Prioridad Media</span>
                        {% endif %}
                    </h4>
                    {% for propuesta in propuestas %}
                    <div class="propuesta-item">
                        <div class="propuesta-content">
                            <i class="{{ propuesta.icono }} propuesta-icon"></i>
                            <span>{{ propuesta.titulo }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endfor %}

                <!-- Link al Plan de Gobierno -->
                {% if candidato.link_plan_gobierno %}
                <div class="card-white" style="background:#f0f9ff;border:1px solid #0ea5e9">
                    <div class="d-flex align-items-center gap-2">
                        <i class="bi bi-info-circle" style="color:#0ea5e9"></i>
                        <span style="font-size:0.85rem;color:#0369a1">
                            Para ver todas las propuestas detalladas, consulta el
                            <a href="{{ candidato.link_plan_gobierno }}" target="_blank" rel="noopener"
                                style="color:#0ea5e9;font-weight:600">Plan de Gobierno completo en el JNE</a>.
                        </span>
                    </div>
                </div>
                {% endif %}

                {% else %}
                <div class="text-center py-5" style="color:var(--text-muted-custom)">
                    <i class="bi bi-clipboard" style="font-size:3rem;display:block;margin-bottom:1rem;opacity:0.5"></i>
                    <p style="font-size:0.95rem">No hay propuestas detalladas registradas aún.</p>
                    {% if candidato.link_plan_gobierno %}
                    <a href="{{ candidato.link_plan_gobierno }}" target="_blank" rel="noopener" class="btn-peru">
                        <i class="bi bi-box-arrow-up-right"></i> Ver Plan de Gobierno en JNE
                    </a>
                    {% else %}
                    <p style="font-size:0.85rem;color:var(--text-muted-custom);margin-top:0.5rem">No se encontró plan de gobierno oficial.</p>
                    {% endif %}
                </div>
                {% endif %}
            </div>

            <!-- TAB: POSICIONES -->
            <div id="content-posiciones" class="tab-content-pane d-none">
                {% if candidato.posicionamiento_issues %}
                <div class="card-white">
                    <h3 class="section-title mb-4">
                        <i class="bi bi-clipboard-check"></i> Posicionamiento en Temas Clave
                    </h3>
                    <p style="font-size:0.85rem;color:#6c757d;margin-bottom:1.5rem">
                        Estas son las posiciones declaradas del candidato en temas importantes para el debate nacional.
                    </p>
                    <div class="posiciones-lista">
                        {% for issue, posicion in candidato.posicionamiento_issues.items %}
                        <div class="posicion-row">
                            <div class="posicion-tema">
                                {% if issue == 'asamblea_constituyente' %}
                                <i class="bi bi-bank2"></i> Asamblea Constituyente
                                {% elif issue == 'privatizacion_empresas_estado' %}
                                <i class="bi bi-building"></i> Privatización de Empresas del Estado
                                {% elif issue == 'libre_comercio_tlc' %}
                                <i class="bi bi-globe-americas"></i> Libre Comercio / TLC
                                {% elif issue == 'pena_muerte' %}
                                <i class="bi bi-exclamation-octagon"></i> Pena de Muerte
                                {% elif issue == 'relaciones_venezuela_cuba' %}
                                <i class="bi bi-flag"></i> Relaciones con Venezuela/Cuba
                                {% elif issue == 'matrimonio_igualitario' %}
                                <i class="bi bi-heart"></i> Matrimonio Igualitario
                                {% elif issue == 'medio_ambiente_prioridad_absoluta' %}
                                <i class="bi bi-tree"></i> Medio Ambiente como Prioridad
                                {% elif issue == 'derechos_animales' %}
                                <i class="bi bi-emoji-heart-eyes"></i> Derechos de los Animales
                                {% else %}
                                <i class="bi bi-question-circle"></i> {{ issue|cut:"_"|title }}
                                {% endif %}
                            </div>
                            <div
                                class="posicion-valor {% if posicion == 'a favor' %}a-favor{% elif posicion == 'en contra' %}en-contra{% elif posicion == 'neutral' %}neutral{% else %}parcial{% endif %}">
                                {% if posicion == 'a favor' %}
                                <i class="bi bi-check-circle-fill"></i> A favor
                                {% elif posicion == 'en contra' %}
                                <i class="bi bi-x-circle-fill"></i> En contra
                                {% elif posicion == 'neutral' %}
                                <i class="bi bi-dash-circle-fill"></i> Neutral
                                {% else %}
                                <i class="bi bi-circle-half"></i> {{ posicion|title }}
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% else %}
                <div class="text-center py-5" style="color:var(--text-muted-custom)">
                    <i class="bi bi-clipboard-x"
                        style="font-size:3rem;display:block;margin-bottom:1rem;opacity:0.5"></i>
                    <p style="font-size:0.95rem">No hay posicionamiento registrado en temas clave.</p>
                </div>
                {% endif %}
            </div>

            <!-- TAB: BIOGRAFIA -->
            <div id="content-biografia" class="tab-content-pane d-none">
                <div class="card-white mb-4">
                    <h3 class="section-title mb-3">Sobre {{ candidato.nombre }}</h3>
                    <p style="line-height:1.8;color:#4a5568">{{ candidato.biografia }}</p>
                </div>
                <div class="card-white mb-4">
                    <h3 class="section-title mb-3">Experiencia</h3>
                    <p style="line-height:1.8;color:#4a5568">{{ candidato.experiencia }}</p>
                </div>
            </div>

            <!-- TAB: ANTECEDENTES -->
            {% if candidato.antecedentes %}
            <div id="content-antecedentes" class="tab-content-pane d-none">
                <div class="card-white" style="border-left:4px solid #e67e22">
                    <div class="d-flex align-items-center gap-2 mb-3">
                        <i class="bi bi-exclamation-triangle-fill" style="font-size:1.5rem;color:#e67e22"></i>
                        <h3 style="font-weight:800;color:#e67e22;font-size:1.1rem;margin:0">Antecedentes Legales y
                            Judiciales</h3>
                    </div>
                    <p style="line-height:1.9;color:#4a5568;font-size:0.95rem">{{ candidato.antecedentes }}</p>
                    <div style="background:#fff8ef;border-radius:8px;padding:0.75rem;margin-top:1rem">
                        <p style="font-size:0.78rem;color:#9ca3af;margin:0">
                            <i class="bi bi-info-circle"></i>
                            Esta información proviene de registros públicos, sentencias judiciales y medios de
                            comunicación verificados.
                            La plataforma es informativa y no toma partido ni emite opinión sobre los procesos
                            judiciales.
                            Para mayor información consulta el <a href="https://www.pj.gob.pe" target="_blank"
                                rel="noopener" style="color:var(--peru-red)">Poder Judicial del Perú</a>.
                        </p>
                    </div>
                </div>
            </div>
            {% endif %}

        </div>

        <!-- SIDEBAR -->
        <div class="col-lg-4">
            <!-- Info partido -->
            <div class="card-white mb-3">
                <h5 style="font-weight:700;font-size:0.9rem;margin-bottom:1rem;color:var(--dark)">
                    <i class="bi bi-flag"></i> Partido Político
                </h5>
                <div style="display:flex;align-items:center;gap:10px">
                    <div
                        style="width:40px;height:40px;border-radius:8px;background:{{ candidato.partido.color_primario }};display:flex;align-items:center;justify-content:center;color:white;font-weight:800;font-size:0.75rem;flex-shrink:0">
                        {{ candidato.partido.siglas|slice:":2" }}
                    </div>
                    <div>
                        <div style="font-weight:600;font-size:0.9rem">{{ candidato.partido.nombre }}</div>
                        {% if candidato.partido.ideologia %}
                        <div style="font-size:0.78rem;color:var(--text-muted-custom)">{{ candidato.partido.ideologia }}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Fuente de datos -->
            {% if candidato.fuente_datos or candidato.verificado %}
            <div class="card-white mb-3" style="background:#f0fdf4;border:1px solid #86efac">
                <div class="d-flex align-items-start gap-2">
                    <i class="bi bi-patch-check-fill" style="color:#22c55e;font-size:1.1rem"></i>
                    <div>
                        <div style="font-weight:600;font-size:0.85rem;color:#166534">Información Verificada</div>
                        <div style="font-size:0.78rem;color:#4ade80">Fuente: {{ candidato.fuente_datos }}</div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Acciones -->
            <div class="card-white mb-3">
                <h5 style="font-weight:700;font-size:0.9rem;margin-bottom:1rem;color:var(--dark)">Acciones</h5>
                <div class="d-flex flex-column gap-2">
                    {% if candidato.link_plan_gobierno %}
                    <a href="{{ candidato.link_plan_gobierno }}" target="_blank" rel="noopener" class="btn-peru"
                        style="background:var(--gold);color:var(--dark);border-color:var(--gold);justify-content:center">
                        <i class="bi bi-box-arrow-up-right"></i> Ver Plan de Gobierno (JNE)
                    </a>
                    {% endif %}
                    <button onclick="votarDesdeDetalle({{ candidato.id }})"
                        class="btn-outline-peru vote-btn-{{ candidato.id }}" style="justify-content:center"
                        id="voteBtn">
                        <i class="bi bi-box2-heart"></i> Votar por este candidato
                    </button>
                    <a href="{% url 'candidatos:comparar' %}?c={{ candidato.id }}" class="btn-outline-peru"
                        style="justify-content:center">
                        <i class="bi bi-columns-gap"></i> Comparar con otros
                    </a>
                    <a href="{% url 'candidatos:quiz' %}" class="btn-peru" style="justify-content:center">
                        <i class="bi bi-lightning-fill"></i> Hacer el Test Electoral
                    </a>
                </div>
            </div>

            <!-- Otros candidatos -->
            {% if otros_candidatos %}
            <div class="card-white">
                <h5 style="font-weight:700;font-size:0.9rem;margin-bottom:1rem;color:var(--dark)">
                    Otros candidatos
                </h5>
                {% for otro in otros_candidatos %}
                <a href="{% url 'candidatos:candidato_detail' otro.slug %}"
                    style="text-decoration:none;display:flex;align-items:center;gap:10px;padding:0.5rem;border-radius:8px;transition:background 0.2s;margin-bottom:0.25rem"
                    onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'">
                    <div
                        style="width:36px;height:36px;border-radius:50%;background:#e9ecef;overflow:hidden;flex-shrink:0">
                        {% if otro.get_foto %}
                        <img src="{{ otro.get_foto }}" alt="{{ otro.nombre }}"
                            style="width:100%;height:100%;object-fit:cover">
                        {% else %}
                        <div
                            style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:18px;color:#adb5bd">
                            <i class="bi bi-person-fill"></i>
                        </div>
                        {% endif %}
                    </div>
                    <div>
                        <div style="font-size:0.85rem;font-weight:600;color:var(--dark)">{{ otro.nombre }}</div>
                        <div style="font-size:0.75rem;color:var(--text-muted-custom)">{{ otro.partido.siglas }}</div>
                    </div>
                </a>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
</div>

<link rel="stylesheet" href="{% static 'css/candidato_detail.css' %}">

{% endblock %}

{% block extra_js %}
<!-- hidden element to provide CSRF token for AJAX -->
<div id="vote-csrf" class="d-none" data-csrf="{{ csrf_token }}"></div>
<script src="{% static 'js/candidato_detail.js' %}"></script>
{% endblock %}